# Tmux для новичков: от нуля до продуктивности

## Что такое tmux?

**Tmux** (Terminal Multiplexer) - это инструмент, который позволяет:
- Разделять один терминал на несколько панелей
- Создавать несколько "сессий" терминала
- Отключаться от сессии и возвращаться к ней позже
- Работать с несколькими проектами одновременно

## Зачем tmux + Neovim?

### Классический workflow:
```
Сессия "myproject":
┌─────────────────┬─────────────────┐
│                 │                 │
│    Neovim       │   Git commands  │
│  (код проекта)  │   npm run dev   │
│                 │   ./run.sh      │
├─────────────────┼─────────────────┤
│                 │                 │
│   File manager  │    Tests        │
│     (ranger)    │  npm test       │
│                 │  ./test.sh      │
└─────────────────┴─────────────────┘
```

### Преимущества:
- **Персистентность**: закрыли терминал → сессия продолжает работать
- **Контекст**: каждый проект в своей сессии
- **Многозадачность**: код + сервер + тесты + git в одном окне

## Установка

### macOS:
```bash
brew install tmux
```

### Linux:
```bash
# Ubuntu/Debian
sudo apt install tmux

# Fedora
sudo dnf install tmux

# Arch
sudo pacman -S tmux
```

## Основные концепции

### 1. **Сессии** (Sessions)
- Изолированные рабочие среды
- Можно отключиться и подключиться позже
- Обычно одна сессия = один проект

### 2. **Окна** (Windows)
- Внутри сессии
- Как табы в браузере
- Переключение по номерам

### 3. **Панели** (Panes)
- Разделение одного окна
- Горизонтально/вертикально

## Prefix Key (главное понятие!)

По умолчанию **Ctrl-b** - это "prefix key". Почти все команды tmux начинаются с него.

**Схема**: `Ctrl-b` → отпустить → команда

Например: `Ctrl-b` → `%` = разделить панель вертикально

## Основные команды для старта

### Управление сессиями
```bash
tmux                          # Создать новую сессию
tmux new -s myproject         # Создать сессию с именем "myproject"
tmux ls                       # Список сессий
tmux attach -t myproject      # Подключиться к сессии "myproject"
tmux kill-session -t myproject # Убить сессию
```

### Внутри tmux (prefix = Ctrl-b):
```
Ctrl-b d                     # Отключиться от сессии (detach)
Ctrl-b $                     # Переименовать сессию
Ctrl-b s                     # Список сессий (для переключения)
```

### Управление панелями
```
Ctrl-b %                     # Разделить вертикально   |
Ctrl-b "                     # Разделить горизонтально ─
Ctrl-b ←→↑↓                  # Переключение между панелями
Ctrl-b x                     # Закрыть панель
Ctrl-b z                     # Zoom панель (развернуть/свернуть)
Ctrl-b {                     # Переместить панель влево
Ctrl-b }                     # Переместить панель вправо
```

### Управление окнами
```
Ctrl-b c                     # Создать новое окно
Ctrl-b n                     # Следующее окно
Ctrl-b p                     # Предыдущее окно
Ctrl-b 1-9                   # Перейти к окну номер N
Ctrl-b ,                     # Переименовать окно
Ctrl-b &                     # Закрыть окно
```

## Практический пример: настройка проекта

### 1. Создайте сессию для проекта
```bash
tmux new -s myapp
```

### 2. Настройте layout
```bash
# В tmux:
Ctrl-b "                     # Разделить горизонтально
Ctrl-b %                     # Разделить правую панель вертикально
```

### 3. Результат:
```
┌─────────────────┬─────────────────┐
│                 │                 │
│    Neovim       │      Git        │
│                 │                 │
├─────────────────┼─────────────────┤
│                 │                 │
│   Терминал      │    npm run dev  │
│                 │                 │
└─────────────────┴─────────────────┘
```

### 4. В каждой панели запустите нужные команды:
- Панель 1: `nvim .`
- Панель 2: `git status`
- Панель 3: обычный терминал
- Панель 4: `npm run dev`

### 5. Отключитесь и подключитесь:
```bash
Ctrl-b d                     # Отключиться
# Закрыли терминал, пошли пить кофе...
tmux attach -t myapp         # Все как было!
```

## Полезная конфигурация ~/.tmux.conf

```bash
# Создайте файл ~/.tmux.conf
cat > ~/.tmux.conf << 'EOF'
# Изменить prefix на Ctrl-a (удобнее)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Быстрое разделение панелей
bind | split-window -h
bind - split-window -v

# Vim-like навигация по панелям
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Включить мышь
set -g mouse on

# Улучшить цвета для Neovim
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color*:Tc"

# Увеличить историю
set -g history-limit 10000

# Начинать нумерацию с 1
set -g base-index 1
set -g pane-base-index 1

# Быстрая перезагрузка конфига
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Статус-бар
set -g status-bg black
set -g status-fg white
set -g status-left '#[fg=green]#S '
set -g status-right '#[fg=yellow]%Y-%m-%d %H:%M'
EOF

# Перезагрузить конфиг
tmux source-file ~/.tmux.conf
```

После этой конфигурации prefix станет `Ctrl-a` (удобнее чем Ctrl-b).

## Типичные workflow с Neovim

### Вариант 1: Простой
```
┌─────────────────┬─────────────────┐
│                 │                 │
│    Neovim       │   Terminal      │
│                 │   git, npm, etc │
│                 │                 │
└─────────────────┴─────────────────┘
```

### Вариант 2: Продвинутый
```
┌─────────────────┬─────────────────┐
│                 │    File tree    │
│    Neovim       │    (ranger)     │
│                 ├─────────────────┤
│                 │   Dev server    │
│                 │  npm run dev    │
└─────────────────┴─────────────────┘
```

### Вариант 3: Максимальный
```
┌─────────────────┬─────────┬───────┐
│                 │   Git   │ Tests │
│    Neovim       │ status  │ watch │
│                 ├─────────┼───────┤
│                 │ Terminal│ Logs  │
│                 │commands │ tail  │
└─────────────────┴─────────┴───────┘
```

## Команды для ежедневного использования

### Быстрый старт проекта:
```bash
# Создать и настроить сессию одной командой
tmux new -s myproject \; \
  split-window -h \; \
  split-window -v \; \
  select-pane -t 0
```

### Список полезных сочетаний:
```
Ctrl-a |                     # Вертикальный split (после конфига)
Ctrl-a -                     # Горизонтальный split (после конфига)
Ctrl-a h,j,k,l               # Vim-навигация между панелями
Ctrl-a z                     # Zoom/unzoom панель
Ctrl-a d                     # Detach от сессии
Ctrl-a r                     # Reload конфига (после конфига)
```

## Интеграция с Neovim

### В .bashrc или .zshrc добавьте:
```bash
# Автоматически прикрепляться к tmux при входе в терминал
if command -v tmux &> /dev/null && [ -z "$TMUX" ]; then
    tmux attach -t default || tmux new -s default
fi

# Алиас для быстрого создания сессий
alias tn='tmux new -s'
alias ta='tmux attach -t'
alias tl='tmux ls'
alias tk='tmux kill-session -t'
```

## Советы для начинающих

### 1. Начните просто
- Создайте одну сессию
- Разделите на 2 панели: nvim + terminal
- Привыкните к prefix key

### 2. Постепенно добавляйте
- Больше панелей
- Несколько окон  
- Несколько сессий для разных проектов

### 3. Изучите постепенно
- Сначала: создание/удаление панелей
- Потом: окна и сессии
- В конце: продвинутые настройки

### 4. Частые ошибки
- Забывать prefix key
- Пытаться закрыть tmux через Ctrl-C
- Не использовать detach (Ctrl-a d)

## Заключение

**Tmux + Neovim** = мощная комбинация для разработки:
- Один терминал = целая IDE
- Персистентные сессии
- Быстрое переключение между задачами
- Никогда не теряете контекст работы

Начните с простого layout (nvim + terminal), постепенно усложняйте!