# Tree-sitter в Neovim: Революция в понимании кода

## Что такое Tree-sitter?

Tree-sitter - это **инкрементальный парсер** кода, который строит синтаксическое дерево (AST - Abstract Syntax Tree) вашего кода в реальном времени. Это не просто система подсветки синтаксиса - это фундаментальное изменение того, как редактор "понимает" ваш код.

## Почему это революционно?

### Старый подход (regex-based highlighting)
```
if (condition) {
    // Видит только: "if", "(", "condition", ")", "{"
    // Не понимает структуру и связи
}
```

### Новый подход (Tree-sitter)
```
Program
├── IfStatement
│   ├── Condition
│   │   └── Identifier: "condition"
│   └── Block
│       └── Comment: "// комментарий"
```

Tree-sitter **понимает структуру** кода как дерево элементов с их отношениями.

## Что дает Tree-sitter в вашей конфигурации

### 1. Умная подсветка синтаксиса
- **Контекстная подсветка**: одно и то же слово может подсвечиваться по-разному в зависимости от контекста
- **Точность**: различает переменные, функции, классы, ключевые слова
- **Скорость**: инкрементальный парсинг = обновление только изменений

### 2. Правильные отступы
```lua
indent = { enable = true, disable = { 'ruby' } }
```
Tree-sitter знает структуру блоков и может правильно расставлять отступы.

### 3. Инкрементальное выделение (включено в вашей конфигурации)
- `Alt+↑` - расширить выделение на следующий уровень синтаксического дерева
- `Alt+↓` - сузить выделение
- Выделяет логические блоки: функции, циклы, условия

## Поддерживаемые языки в вашей конфигурации

```lua
ensure_installed = { 
  'bash', 'c', 'diff', 'html', 'lua', 'luadoc', 
  'markdown', 'markdown_inline', 'query', 'vim', 'vimdoc' 
}
```

### Автоматическая установка
```lua
auto_install = true  -- Автоматически скачивает парсеры для новых языков
```

## Команды Tree-sitter

### Управление парсерами
```vim
:TSInstall python          " Установить парсер для Python
:TSUpdate                  " Обновить все парсеры
:TSUninstall javascript    " Удалить парсер
:TSInstallInfo            " Показать доступные парсеры
```

### Диагностика
```vim
:TSPlayground             " Интерактивное дерево синтаксиса
:TSHighlightCapturesUnderCursor  " Показать группы подсветки под курсором
```

## Почему все считают его важным?

### 1. Основа для современных возможностей
- **Textobjects**: `vif` (выделить функцию), `dac` (удалить класс)
- **Умная навигация**: переходы по функциям, классам, блокам
- **Рефакторинг**: переименование с пониманием области видимости

### 2. Производительность
- **Инкрементальность**: парсит только изменения
- **Асинхронность**: не блокирует редактор
- **Кэширование**: сохраняет результаты парсинга

### 3. Точность
- **Контекстное понимание**: знает разницу между `string` как типом и как переменной
- **Область видимости**: понимает локальные vs глобальные переменные
- **Семантика**: различает объявление и использование функций

## Расширения Tree-sitter

### Tree-sitter Context (рекомендуется)
```lua
-- Показывает контекст (функция/класс) вверху экрана
{
  'nvim-treesitter/nvim-treesitter-context',
  opts = { max_lines = 3 }
}
```

### Tree-sitter Textobjects
```lua
-- Умные textobjects: vif, dac, etc.
{
  'nvim-treesitter/nvim-treesitter-textobjects',
  dependencies = 'nvim-treesitter/nvim-treesitter'
}
```

## Практические примеры

### До Tree-sitter:
```python
def function():  # Просто ключевое слово "def"
    if True:     # Просто ключевое слово "if"  
        pass     # Просто ключевое слово "pass"
```

### С Tree-sitter:
```python
def function():  # FunctionDefinition > name: Identifier
    if True:     # IfStatement > condition: Boolean
        pass     # PassStatement
```

### Умное выделение:
- `vif` - выделить всю функцию (function body)
- `vac` - выделить весь класс
- `vic` - выделить содержимое класса
- `vip` - выделить параметры функции

## Отличие от LSP

### Tree-sitter (локальный)
- Синтаксический анализ
- Подсветка и структура
- Работает автономно
- Быстрый, всегда доступен

### LSP (серверный)
- Семантический анализ
- Автодополнение, ошибки, рефакторинг
- Требует language server
- Медленнее, но умнее

## Заключение

Tree-sitter - это **фундамент** современного редактора кода. Он превращает текстовый редактор в инструмент, который понимает структуру вашего кода. Без Tree-sitter многие современные возможности (умные textobjects, контекстная подсветка, структурная навигация) были бы невозможны.

В вашей конфигурации Tree-sitter уже настроен и работает - вы видите его результаты каждый раз, когда открываете файл с кодом!
